<div class="dialog-container">
    <div class="dialog-header">
        <div class="title-wrapper">
            <div class="icon-circle">
                <mat-icon>inventory_2</mat-icon>
            </div>
            <div>
                <h2 class="dialog-title">{{ isEditMode ? 'Edit Item' : 'New Item' }}</h2>
                <p class="dialog-subtitle">{{ isEditMode ? 'Update details' : 'Add new product or service' }}</p>
            </div>
        </div>
        <button mat-icon-button class="close-btn" (click)="onCancel()" type="button">
            <mat-icon>close</mat-icon>
        </button>
    </div>

    <div class="dialog-content">
        <form [formGroup]="inventoryForm" (ngSubmit)="onSubmit()">
            <mat-tab-group animationDuration="0ms" class="inventory-tabs">
                <mat-tab label="Basic Info">
                    <div class="form-grid tab-content">
                        <!-- Name (Full Width) -->
                        <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
                            <input matInput formControlName="name" placeholder="Item Name / Service Title" required>
                            <mat-icon matPrefix>inventory_2</mat-icon>
                            <mat-error *ngIf="inventoryForm.get('name')?.hasError('required')">Required</mat-error>
                        </mat-form-field>

                        <!-- Category -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <input matInput formControlName="category" placeholder="Category"
                                [matAutocomplete]="autoCat">
                            <mat-icon matPrefix>category</mat-icon>
                            <mat-autocomplete #autoCat="matAutocomplete">
                                @for (cat of categories(); track cat) {
                                <mat-option [value]="cat">{{ cat }}</mat-option>
                                }
                            </mat-autocomplete>
                        </mat-form-field>

                        <!-- SKU -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <input matInput formControlName="sku" placeholder="SKU / Code (Optional)">
                            <mat-icon matPrefix>qr_code</mat-icon>
                        </mat-form-field>

                        <!-- Description (Full Width) -->
                        <mat-form-field appearance="outline" class="full-width textarea-field"
                            subscriptSizing="dynamic">
                            <textarea matInput formControlName="description" rows="2"
                                placeholder="Description / Specifications..."></textarea>
                            <mat-icon matPrefix>description</mat-icon>
                        </mat-form-field>

                        <!-- Unit Price -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <span matPrefix class="currency-prefix">Rs&nbsp;</span>
                            <input matInput type="number" formControlName="unit_price" min="0" placeholder="Unit Price">
                        </mat-form-field>

                        <!-- Display Unit -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <mat-select formControlName="unit" placeholder="Display Unit">
                                @for (u of units; track u.value) {
                                <mat-option [value]="u.value">{{ u.label }}</mat-option>
                                }
                            </mat-select>
                            <mat-icon matPrefix>straighten</mat-icon>
                        </mat-form-field>
                    </div>
                </mat-tab>

                <mat-tab label="Inventory Settings">
                    <div class="form-grid tab-content">
                        <!-- Base Unit -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <mat-label>Base Unit</mat-label>
                            <mat-select formControlName="base_unit">
                                <mat-option [value]="null">-- None --</mat-option>
                                @for (unit of unitsList(); track unit.id) {
                                <mat-option [value]="unit.id">{{ unit.name }} ({{ unit.code }})</mat-option>
                                }
                            </mat-select>
                            <mat-icon matPrefix>scale</mat-icon>
                            <mat-hint>Conversion base (e.g., Inches)</mat-hint>
                        </mat-form-field>

                        <!-- Default Location -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <mat-label>Default Location</mat-label>
                            <mat-select formControlName="default_location">
                                <mat-option [value]="null">-- None --</mat-option>
                                @for (loc of locationsList(); track loc.id) {
                                <mat-option [value]="loc.id">{{ loc.name }}</mat-option>
                                }
                            </mat-select>
                            <mat-icon matPrefix>place</mat-icon>
                        </mat-form-field>

                        <!-- Min Stock Level -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <mat-label>Min Stock Alert</mat-label>
                            <input matInput type="number" formControlName="min_stock_level" min="0">
                            <mat-icon matPrefix>warning</mat-icon>
                        </mat-form-field>

                        <!-- Reorder Level -->
                        <mat-form-field appearance="outline" subscriptSizing="dynamic">
                            <mat-label>Reorder Level</mat-label>
                            <input matInput type="number" formControlName="reorder_level" min="0">
                            <mat-icon matPrefix>autorenew</mat-icon>
                        </mat-form-field>

                        <!-- Batch Tracking -->
                        <div class="full-width" style="margin-top: 1rem;">
                            <mat-checkbox formControlName="batch_tracking" color="primary">
                                Enable Batch / Lot Tracking
                            </mat-checkbox>
                            <p class="hint-text">Track expiry dates and batch numbers for this item.</p>
                        </div>
                    </div>
                </mat-tab>
            </mat-tab-group>

            <div class="dialog-actions">
                <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="isLoading()">
                    <mat-icon>save</mat-icon>
                    {{ isLoading() ? 'Saving...' : (isEditMode ? 'Update' : 'Save Item') }}
                </button>
            </div>
        </form>
    </div>
</div>